---
title: "Explore ARTIS API"
output: html_document
date: "2024-06-12"
---

## Summary

Pull and explore data from the ARTIS github:
 - ARTIS API project: https://github.com/Seafood-Globalization-Lab/ARTIS-API
    - I don't believe this is fully operational yet. 
 - Explore ARTIS project: https://github.com/Seafood-Globalization-Lab/exploreARTIS

Ok so seems like there isn't a sample ARTIS data set anywhere... I guess I could use the BACI trade data instead? Although I don't think that has live weight info.

## Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)
library(glue)
library(sf)
library(devtools)

# devtools::install_github("davidsjoberg/ggsankey")
# devtools::install_github("Seafood-Globalization-Lab/exploreARTIS", dependencies = TRUE) # install explore ARTIS package

library(ggsankey)
library(exploreARTIS)

load(here("data/artis_spatial.rda")) # load data that was stored on the exploreArtis github repo; looks like this is spatial information

load(here("data/mini_artis.rda")) # load data that was stored on the exploreArtis github repo; looks like this is a subset of the artis database!

load(here("data/mini_consumption.rda")) # looks like this is some consumption info where there is an intermdiate country involved?

```


## Explore data

 - This exploration is directly taken from the exploreArtis github 

```{r}
# Analyzing volumes

plot_bar(mini_artis, bar_group = "exporter_iso3c")

plot_bar(mini_artis, bar_group = "exporter_iso3c", fill_type = "dom_source")

# Analyzing trade partners

# plot_partner_line(mini_artis, trade_flow = "export") # commented out code doesn't work
# 
# plot_partner_stacked(mini_artis, trade_flow = "export")
# 
# 
# plot_species_line(mini_artis, plot.title = "Species Trends 1995 - 2019")
# 
# plot_species_stacked(mini_artis)

plot_sankey(mini_artis)
plot_sankey(mini_consumption, cols = c("source_country_iso3c", "exporter_iso3c", "consumer_iso3c"), value = "consumption_t")
# plot_chord(mini_artis) # doesnt work

# plot_map(mini_artis, exporters = "CHN", country_fill = "live_weight_t", flow_arrows = TRUE)

```


Ok, so seems like the demo data that ARTIS provides has this information: 

exporter_iso3c (string): Exporter Country ISO 3 code
importer_iso3c (string): Importer Country ISO 3 code
source_country_iso3c (string): Producer Country ISO 3 code
dom_source (string): Domestic Export / Foreign Export / Error Export
hs6 (string): 6-digit HS commodity code
sciname (string): Species or Species group
habitat (string): Marine / Freshwater
method (string): Capture / Aquaculture / Unknown
product_weight_t (double): Product weight (tonnes)
live_weight_t (double): Live weight (tonnes)
hs_version (string): version of HS codes
year (double): Year


Looks like for our purposes, we will probably just want the source country to begin. Lets filter for fish meal hs code: 230120

```{r}

fm_artis <- mini_artis %>% 
  filter(hs6 == 230120)

fm_artis # ok does the ARTIS database already exclude trimmings? Or would trimmings theoretically be a part of their fish meal estimates, just not acknowledged as such? For example, if Peru exports fish meal to Norway, does that export volume include all fish meal exported from Peru (which would theoretically have trimmings in it)? If so, then we would likely just need to attribute some proportion of the current traded fish meal to trimmings, based on information of the species it comes from, based on the feed company reports. We will just have to assume that all trimmings fish meal is used for feed companies...

# If trimmings is not already included in their fish meal estimates, then we will need to add it in somehow. So If a country is producing some fresh fish, like tuna, some of that goes towards trimmings. Do we just need to take a proportion of that live weight total of Tuna and attribute it to trimmings (e.g., whatever the excess live weight not used would be)? But then how do we track that information... using the same trade patterns of fish meal? We would likely have to assume that fish meal is processed in the same country as the fish capture/aquaculture. What if the trimmings country doesn't have fish meal trade, what do we do then? 

# I'm guessing that the data gap is a combination of both of the problems listed above. 

```

